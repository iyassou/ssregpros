seed: 0
batch_size: 4
dataset_split: [0.8, 0.1, 0.1]

# ==== Preprocessing Pipeline
preprocessor:
  # Value(s) to consider changing.
  mri_mask_prostate_area_square_millimetres_threshold: 1600
  # "Constant" defaults, don't imagine these would change.
  # Although their values reflect their defaults in code, they're
  # made explicit here.
  mri_orientation: "RAS"
  mri_slice_height: 128
  mri_slice_width: 128
  pixel_spacing_millimetres: 0.5
  histology_tissue_fraction_estimation_thumbnail_max_size: 1024
  histology_macenko_pixel_count_threshold: 50000
  histology_tissue_estimate_closing_se_kernel_size_percentage: 0.005
  histology_tissue_estimate_minimum_hole_area_ratio: 0.0005
  histology_haematoxylin_mask_closing_se_kernel_size_percentage: 0.05
  histology_haematoxylin_mask_minimum_hole_area_ratio: 0.005

# ==== Registration Network
registration_network:
  # Value(s) to consider changing.
  resnet: "resnet101"
  regression_head_bottleneck_layer_size: 1024
  # "Constant" defaults.
  regression_head_shrinkage_range: [0.05, 0.25]
  height: 128
  width: 128

# ==== Loss Function
loss:
  ncc_weight: 1
  sobel_weight: 0
  boundary_heatmap_weight: 0
  transformation_parameters_weight: 1

# ==== Training
training:
  save_images_to_disk: true
  checkpointer_cleanup_on_exit: true # deletes model checkpoints only
  gradient_accumulation_steps: 2
  # Training Scheme
  monitored_validation_metric: -ncc_loss
  early_stopping_mode: min
  early_stopping_min_delta_rel: 1.0e-3
  early_stopping_min_delta_abs: 1.0e-4
  # > Phase A
  lp_checkpointer_top_k: 2
  lp_early_stopping_min_epochs: 200
  lp_max_epochs: 220
  lp_patience_steps: 10
  lp_learning_rate: 0.001
  lp_weight_decay: 0.01
  # > Phase B
  ft_checkpointer_top_k: 3
  ft_early_stopping_min_epochs: 1
  ft_max_epochs: 1
  ft_patience_steps: 2
  ft_learning_rate: 0.001
  ft_weight_decay: 0.01
  ft_unfreeze_plan: ["layer1", "layer2", "layer3", "layer4"]
  ft_unfreeze_learning_rate_multipliers: [0.75, 0.5, 0.25, 0.1]
  ft_unfreeze_patience_steps: 10
  ft_unfreeze_min_delta_rel: 5.0e-4
  ft_unfreeze_min_delta_abs: 5.0e-5
